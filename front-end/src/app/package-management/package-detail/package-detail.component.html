<div class="page-wrapper">
    <div class="page-content">

        <div class="heading show-border-dev">
            <span class="example-spacer"></span>

            <button mat-stroked-button color="primary" *ngIf="this.packageNameUpdated" (click)="onUpdateTitle()" style="height: 36px;">更新</button>

        </div>

        <div class="image-gallery">
            <gallery class="gallery" [items]="images" [thumb]="true" thumbPosition="left" thumbMode="free" [counter]="false" slidingDirection="vertical" [nav]="false" (itemClick)="onGalleryItemClick($event)" [autoPlay]="false" [playerInterval]="5000" #gallery></gallery>

            <input type="file" accept="image/*" hidden="true" #imageInput (change)="onUploadScreenshot(imageInput)">
        </div>

        <div class="info-container">
            <h1 style="margin: 0;">
                <div #packageNameTitle class="title" (focus)="this.packageNameUpdated=true;">
                    {{this.package.packageName}} </div>
            </h1>
            <div class="info-content">

                <div class="primary-info-render">
                    <div class="counter-render">
                        <span>{{this.package.downloadCount}} 下载</span>
                    </div>
                    <div class="create-time-render">
                        <span class="dot-render"></span>
                        <span matTooltip="创建日期">{{this.package.createTime}}</span>
                    </div>
                    <div class="create-time-render">
                        <span class="dot-render"></span>
                        <span matTooltip="最近更新">{{this.package.updateTime}}</span>
                    </div>
                </div>

                <div style="flex-grow: 1;"></div>

                <div class="top-level-buttons">
                    <div class="icon-button">
                        <a matTooltip="我要点赞" class="toggle-button-render">
                            <button mat-icon-button class="button-svg" (click)="onToggleLike()">
                                <svg *ngIf="!liked" viewBox="0 0 24 24"
                                    preserveAspectRatio="xMidYMid meet"
                                    focusable="false" style="pointer-events:
                                    none; display: block; width: 100%; height:
                                    100%;" class="style-scope yt-icon"><g
                                        class="style-scope yt-icon"><path
                                            d="M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11H3v10h4h1h9.43
                                            c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z
                                            M7,20H4v-8h3V20z
                                            M19.98,13.17l-1.34,6
                                            C18.54,19.65,18.03,20,17.43,20H8v-8.61l5.6-6.06C13.79,5.12,14.08,5,14.38,5c0.26,0,0.5,0.11,0.63,0.3
                                            c0.07,0.1,0.15,0.26,0.09,0.47l-1.52,4.94L13.18,12h1.35h4.23c0.41,0,0.8,0.17,1.03,0.46C19.92,12.61,20.05,12.86,19.98,13.17z"
                                            class="style-scope yt-icon"></path></g></svg>
                                <svg *ngIf="liked" viewBox="0 0 24 24"
                                    preserveAspectRatio="xMidYMid meet"
                                    focusable="false" style="pointer-events:
                                    none; display: block; width: 100%; height:
                                    100%;" class="style-scope yt-icon"><g
                                        class="style-scope yt-icon"><path
                                            d="M3,11h3v10H3V11z
                                            M18.77,11h-4.23l1.52-4.94C16.38,5.03,15.54,4,14.38,4c-0.58,0-1.14,0.24-1.52,0.65L7,11v10h10.43
                                            c1.06,0,1.98-0.67,2.19-1.61l1.34-6C21.23,12.15,20.18,11,18.77,11z"
                                            class="style-scope yt-icon"></path></g></svg>
                            </button>

                            <!-- Replace with live count -->
                            <span class="toggle-button-text">0</span>
                        </a>
                    </div>
                    <div class="icon-button">
                        <a matTooltip="不喜欢" class="toggle-button-render">
                            <button mat-icon-button class="button-svg" (click)="onToggleDislike()">
                                <svg *ngIf="!disliked" viewBox="0 0 24 24"
                                    preserveAspectRatio="xMidYMid meet"
                                    focusable="false" style="pointer-events:
                                    none; display: block; width: 100%; height:
                                    100%;" class="style-scope yt-icon"><g
                                        class="style-scope yt-icon"><path
                                            d="M17,4h-1H6.57C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21
                                            c0.58,0,1.14-0.24,1.52-0.65L17,14h4V4H17z
                                            M10.4,19.67C10.21,19.88,9.92,20,9.62,20c-0.26,0-0.5-0.11-0.63-0.3
                                            c-0.07-0.1-0.15-0.26-0.09-0.47l1.52-4.94l0.4-1.29H9.46H5.23c-0.41,0-0.8-0.17-1.03-0.46c-0.12-0.15-0.25-0.4-0.18-0.72l1.34-6
                                            C5.46,5.35,5.97,5,6.57,5H16v8.61L10.4,19.67z
                                            M20,13h-3V5h3V13z"
                                            class="style-scope yt-icon"></path></g></svg>
                                <svg *ngIf="disliked" viewBox="0 0 24 24"
                                    preserveAspectRatio="xMidYMid meet"
                                    focusable="false" style="pointer-events:
                                    none; display: block; width: 100%; height:
                                    100%;" class="style-scope yt-icon"><g
                                        class="style-scope yt-icon"><path
                                            d="M18,4h3v10h-3V4z
                                            M5.23,14h4.23l-1.52,4.94C7.62,19.97,8.46,21,9.62,21c0.58,0,1.14-0.24,1.52-0.65L17,14V4H6.57
                                            C5.5,4,4.59,4.67,4.38,5.61l-1.34,6C2.77,12.85,3.82,14,5.23,14z"
                                            class="style-scope yt-icon"></path></g></svg>
                            </button>
                            <span class="toggle-button-text">不喜欢</span>
                        </a>
                    </div>

                    <div class="icon-button">
                        <a matTooltip="分享 (未开放)" class="toggle-button-render
                            disabled-text">
                            <button mat-icon-button class="button-svg">
                                <svg viewBox="0 0 24 24"
                                    preserveAspectRatio="xMidYMid meet"
                                    focusable="false" style="pointer-events:
                                    none; display: block; width: 100%; height:
                                    100%;" class="style-scope yt-icon"><g
                                        mirror-in-rtl="" class="style-scope
                                        yt-icon"><path
                                            d="M15,5.63L20.66,12L15,18.37V15v-1h-1c-3.96,0-7.14,1-9.75,3.09c1.84-4.07,5.11-6.4,9.89-7.1L15,9.86V9V5.63
                                            M14,3v6
                                            C6.22,10.13,3.11,15.33,2,21c2.78-3.97,6.44-6,12-6v6l8-9L14,3L14,3z"
                                            class="style-scope yt-icon"></path></g></svg>
                            </button>
                            <span class="toggle-button-text">分享</span>
                        </a>
                    </div>

                    <div class="icon-button">
                        <a matTooltip="收藏 (未开放)" class="toggle-button-render
                            disabled-text">
                            <button mat-icon-button class="button-svg">
                                <svg viewBox="0 0 24 24"
                                    preserveAspectRatio="xMidYMid meet"
                                    focusable="false" style="pointer-events:
                                    none; display: block; width: 100%; height:
                                    100%;" class="style-scope yt-icon"><g
                                        class="style-scope yt-icon"><path
                                            d="M22,13h-4v4h-2v-4h-4v-2h4V7h2v4h4V13z
                                            M14,7H2v1h12V7z M2,12h8v-1H2V12z
                                            M2,16h8v-1H2V16z" class="style-scope
                                            yt-icon"></path></g></svg>
                            </button>
                            <span class="toggle-button-text">收藏</span>
                        </a>
                    </div>

                    <div class="icon-button">
                        <a matTooltip="更多" class="toggle-button-render">
                            <button mat-icon-button class="button-svg" [matMenuTriggerFor]="menu">
                                <svg viewBox="0 0 24 24"
                                    preserveAspectRatio="xMidYMid meet"
                                    focusable="false" style="pointer-events:
                                    none; display: block; width: 100%; height:
                                    100%;" class="style-scope yt-icon"><g
                                        class="style-scope yt-icon"><path
                                            d="M7.5,12c0,0.83-0.67,1.5-1.5,1.5S4.5,12.83,4.5,12s0.67-1.5,1.5-1.5S7.5,11.17,7.5,12z
                                            M12,10.5c-0.83,0-1.5,0.67-1.5,1.5
                                            s0.67,1.5,1.5,1.5s1.5-0.67,1.5-1.5S12.83,10.5,12,10.5z
                                            M18,10.5c-0.83,0-1.5,0.67-1.5,1.5s0.67,1.5,1.5,1.5s1.5-0.67,1.5-1.5
                                            S18.83,10.5,18,10.5z"
                                            class="style-scope yt-icon"></path></g></svg>
                            </button>
                            <mat-menu #menu="matMenu">
                                <button mat-menu-item style="display: flex; align-items: center;">
                                    <div style="width: 24px; height: 24px;">
                                        <svg viewBox="0 0 24 24"
                                            preserveAspectRatio="xMidYMid
                                            meet"
                                            focusable="false"
                                            style="pointer-events:
                                            none; display: block; width:
                                            100%;
                                            height: 100%;"
                                            class="style-scope
                                            yt-icon"><g class="style-scope
                                                yt-icon"><path
                                                    d="M13.18,4l0.24,1.2L13.58,6h0.82H19v7h-5.18l-0.24-1.2L13.42,11H12.6H6V4H13.18
                                                    M14,3H5v18h1v-9h6.6l0.4,2h7V5h-5.6L14,3
                                                    L14,3z"
                                                    class="style-scope
                                                    yt-icon"></path></g></svg>
                                    </div>
                                    举报
                                </button>
                            </mat-menu>

                        </a>
                    </div>
                </div>

            </div>
        </div>

        <div class="meta-content">
            <div class="container">
                <div class="top-row">
                    <div class="package-owner-render">

                        <img [hidden]="this.hideAuthorImage" [src]="this.authorImageUrl" (load)="this.hideAuthorImage= false;" class="author-image">
                        <div class="upload-info">
                            <div class="author-name" (click)="onAuthorNameClick()">{{this.author.username}}</div>
                            <div class="author-sub-count">30.1k subscribers</div>
                        </div>

                    </div>
                    <div style="flex-grow: 1;">
                    </div>
                    <div class="subscribe-section">
                        <button class="subscribe-button" mat-flat-button [color]="subscribed?'':'warn'" (click)="onSubscribe()">{{subscribed?'退订':'订阅'}}</button>
                        <div *ngIf="subscribed" class="icon-button" style="margin-left: .5rem !important;">
                            <a class="toggle-button-render disabled-text">
                                <button mat-icon-button class="button-svg" (click)="onNotification()">
                                    <svg *ngIf="notificationEnabled" viewBox="0
                                        0 24 24" preserveAspectRatio="xMidYMid
                                        meet" focusable="false"
                                        style="pointer-events: none; display:
                                        block; width: 100%; height: 100%;"
                                        class="style-scope yt-icon"><g
                                            class="style-scope yt-icon"><path
                                                d="M21.5
                                                8.99992H19.5V8.80992C19.5
                                                6.89992 18.39 5.18991 16.6
                                                4.32991L17.47 2.52991C19.96
                                                3.71991 21.5 6.12992 21.5
                                                8.80992V8.99992ZM4.5 8.80992C4.5
                                                6.89992 5.61 5.18991 7.4
                                                4.32991L6.53 2.52991C4.04
                                                3.71991 2.5 6.12992 2.5
                                                8.80992V8.99992H4.5V8.80992ZM12
                                                21.9999C13.1 21.9999 14 21.0999
                                                14 19.9999H10C10 21.0999 10.9
                                                21.9999 12 21.9999ZM20
                                                17.3499V18.9999H4V17.3499L6
                                                15.4699V10.3199C6 7.39991 7.56
                                                5.09992 10 4.33992V3.95991C10
                                                2.53991 11.49 1.45991 12.99
                                                2.19991C13.64 2.51991 14 3.22991
                                                14 3.95991V4.34991C16.44 5.09991
                                                18 7.40991 18 10.3299V15.4799L20
                                                17.3499Z" class="style-scope
                                                yt-icon"></path></g></svg>
                                    <svg *ngIf="!notificationEnabled" viewBox="0
                                        0 24 24" preserveAspectRatio="xMidYMid
                                        meet" focusable="false"
                                        style="pointer-events: none; display:
                                        block; width: 100%; height: 100%;"
                                        class="style-scope yt-icon"><g
                                            class="style-scope yt-icon"><path
                                                d="M10,20h4c0,1.1-0.9,2-2,2S10,21.1,10,20z
                                                M20,17.35V19H4v-1.65l2-1.88v-5.15c0-2.92,1.56-5.22,4-5.98V3.96
                                                c0-1.42,1.49-2.5,2.99-1.76C13.64,2.52,14,3.23,14,3.96l0,0.39c2.44,0.75,4,3.06,4,5.98v5.15L20,17.35z
                                                M19,17.77l-2-1.88v-5.47
                                                c0-2.47-1.19-4.36-3.13-5.1c-1.26-0.53-2.64-0.5-3.84,0.03C8.15,6.11,7,7.99,7,10.42v5.47l-2,1.88V18h14V17.77z"
                                                class="style-scope yt-icon"></path></g></svg>
                                </button>
                            </a>
                        </div>
                    </div>

                </div>
                <div class="package-description-section">
                    <div #description id="description-container" [class.desc-folded]="descFolded && !descEditor_updated" [class.desc-full]="!(descFolded &&
                        !descEditor_updated)">
                        <ckeditor #description [data]="this.descEditor_data" [editor]="descEditor" (ready)="onDescEditorReady($event)" (change)="onDescEditorChange($event)" [disabled]="this.descEditor_disabled" [config]="this.descEditor_config"></ckeditor>
                    </div>
                    <div *ngIf="!descEditor_updated">
                        <span id="more-button" *ngIf="descFolded" (click)="this.descFolded= false;" class="more-button">更多</span>
                        <!-- <span id="more-button" *ngIf="!descFolded" (click)="this.descFolded = true;" class="more-button">折叠</span> -->
                    </div>
                    <button *ngIf="this.descEditor_updated" mat-stroked-button color="primary" (click)="onUpdateDesc()" class="update-button">更新</button>
                </div>

            </div>

        </div>


        <div class="right-bottom">
            <div class="icon-section">
                <span class="example-spacer"></span>
                <!-- <mat-icon class="icon" matTooltip="总下载量" [matBadge]="this.package.downloadCount" matBadgeSize="small" matBadgeColor="accent" matBadgePosition="above after">download</mat-icon> -->
            </div>

            <div *ngIf="(isAdmin() || isAuthor())" class="package-controller
                top-border show-border-dev">
                <div class="admin-zone" *ngIf="isAdmin()">
                    <button mat-button mat-stroked-button color="accent" *ngIf="this.package.state===2" (click)="onApprove()">通过审核</button>
                    <button mat-button mat-stroked-button color="accent" *ngIf="this.package.state===1 ||
                        this.package.state===3" (click)="onFlipHide()">{{this.package.state===3
                        ? '取消隐藏' : '隐藏'}}</button>
                </div>

                <span [hidden]="!adminZone" class="example-spacer"></span>

                <span class="example-spacer"></span>
                <div class="author-zone" *ngIf="authorZone">

                    <span class="example-spacer"></span>
                    <!-- dangerous zone -->
                    <div class="">
                        <button class="button" mat-stroked-button color="warn" (click)="onDelete()">删除</button>
                    </div>

                </div>
            </div>
        </div>

        <div class="version-info top-border show-border-dev">
            <app-version-panel [package]="this.package" (downloadEvent)="onChildDownload($event)">
            </app-version-panel>
        </div>

        <!-- <app-comment-board [parent]="this.getPackageUrl()" [package]="this.package" class="comment-section"></app-comment-board> -->
        <app-discussion [parent]="this.package.name"></app-discussion>

    </div>
</div>